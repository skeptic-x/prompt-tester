<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prompt Tester</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; min-height: 100vh; }
    
    .header { background: #fff; padding: 16px 24px; border-bottom: 1px solid #e0e0e0; display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
    .header input[type="password"] { flex: 1; min-width: 200px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
    .header select { padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; background: #fff; }
    .header .status { font-size: 12px; color: #666; }
    .header .status.ready { color: #22c55e; }
    
    .container { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 16px; max-width: 1600px; margin: 0 auto; }
    
    .panel { background: #fff; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
    .panel-header { padding: 12px 16px; border-bottom: 1px solid #eee; font-weight: 600; color: #333; display: flex; justify-content: space-between; align-items: center; }
    .panel-header span { font-size: 12px; color: #888; font-weight: normal; }
    
    .system-prompt { padding: 12px; border-bottom: 1px solid #eee; }
    .system-prompt label { font-size: 12px; color: #666; display: block; margin-bottom: 6px; }
    .system-prompt textarea { width: 100%; height: 80px; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 13px; resize: vertical; font-family: inherit; }
    
    .chat-area { flex: 1; min-height: 300px; max-height: 50vh; overflow-y: auto; padding: 16px; }
    .message { margin-bottom: 12px; padding: 10px 14px; border-radius: 8px; font-size: 14px; line-height: 1.5; white-space: pre-wrap; }
    .message.user { background: #e3f2fd; margin-left: 20%; }
    .message.assistant { background: #f5f5f5; margin-right: 20%; }
    .message.error { background: #ffebee; color: #c62828; }
    .message.loading { color: #888; font-style: italic; }
    
    .input-area { padding: 16px; background: #fafafa; border-top: 1px solid #eee; }
    .input-row { display: flex; gap: 8px; }
    .input-area textarea { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; resize: none; height: 60px; font-family: inherit; }
    .input-area button { padding: 12px 24px; background: #2563eb; color: #fff; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: 500; }
    .input-area button:hover { background: #1d4ed8; }
    .input-area button:disabled { background: #ccc; cursor: not-allowed; }
    .input-area button.secondary { background: #6b7280; }
    .input-area button.secondary:hover { background: #4b5563; }

    .full-width { grid-column: 1 / -1; }
    
    @media (max-width: 900px) {
      .container { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="header">
    <input type="password" id="apiKey" placeholder="Paste OpenAI API Key (stored locally in browser)">
    <select id="model">
      <option value="gpt-4o-mini">gpt-4o-mini</option>
      <option value="gpt-4.1-mini">gpt-4.1-mini</option>
      <option value="o3-mini">o3-mini</option>
      <option value="o1-mini">o1-mini</option>
    </select>
    <span class="status" id="status">âšª Enter API key</span>
  </div>

  <div class="container">
    <div class="panel">
      <div class="panel-header">Prompt A <span id="tokensA"></span></div>
      <div class="system-prompt">
        <label>System Prompt</label>
        <textarea id="systemA" placeholder="You are a helpful assistant..."></textarea>
      </div>
      <div class="chat-area" id="chatA"></div>
    </div>

    <div class="panel">
      <div class="panel-header">Prompt B <span id="tokensB"></span></div>
      <div class="system-prompt">
        <label>System Prompt</label>
        <textarea id="systemB" placeholder="You are a helpful assistant..."></textarea>
      </div>
      <div class="chat-area" id="chatB"></div>
    </div>

    <div class="input-area full-width">
      <div class="input-row">
        <textarea id="userInput" placeholder="Type your message... (Enter to send, Shift+Enter for newline)"></textarea>
        <button id="sendBtn" onclick="sendMessage()">Send to Both</button>
        <button class="secondary" onclick="clearChats()">Clear</button>
        <button class="secondary" onclick="retryLast()">Retry</button>
      </div>
    </div>
  </div>

  <script>
    const historyA = [];
    const historyB = [];
    let lastUserMessage = '';

    // Load saved API key
    document.getElementById('apiKey').value = localStorage.getItem('openai_key') || '';
    document.getElementById('systemA').value = localStorage.getItem('systemA') || 'You are a helpful assistant.';
    document.getElementById('systemB').value = localStorage.getItem('systemB') || 'You are a helpful assistant.';
    updateStatus();

    // Save on change
    document.getElementById('apiKey').addEventListener('input', (e) => {
      localStorage.setItem('openai_key', e.target.value);
      updateStatus();
    });
    document.getElementById('systemA').addEventListener('input', (e) => {
      localStorage.setItem('systemA', e.target.value);
    });
    document.getElementById('systemB').addEventListener('input', (e) => {
      localStorage.setItem('systemB', e.target.value);
    });

    // Enter to send
    document.getElementById('userInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    function updateStatus() {
      const status = document.getElementById('status');
      if (document.getElementById('apiKey').value) {
        status.textContent = 'ðŸŸ¢ Ready';
        status.className = 'status ready';
      } else {
        status.textContent = 'âšª Enter API key';
        status.className = 'status';
      }
    }

    function addMessage(chatId, role, content) {
      const chat = document.getElementById(chatId);
      const div = document.createElement('div');
      div.className = `message ${role}`;
      div.textContent = content;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      return div;
    }

    async function callOpenAI(systemPrompt, history, model) {
      const apiKey = document.getElementById('apiKey').value;
      const messages = [
        { role: 'system', content: systemPrompt },
        ...history
      ];

      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({ model, messages })
      });

      const data = await response.json();
      if (data.error) throw new Error(data.error.message);
      return {
        content: data.choices[0].message.content,
        tokens: data.usage?.total_tokens
      };
    }

    async function sendMessage() {
      const input = document.getElementById('userInput');
      const message = input.value.trim();
      if (!message) return;

      lastUserMessage = message;
      input.value = '';

      const model = document.getElementById('model').value;
      const systemA = document.getElementById('systemA').value;
      const systemB = document.getElementById('systemB').value;

      // Add user message to both
      addMessage('chatA', 'user', message);
      addMessage('chatB', 'user', message);
      historyA.push({ role: 'user', content: message });
      historyB.push({ role: 'user', content: message });

      // Loading indicators
      const loadingA = addMessage('chatA', 'loading', 'Thinking...');
      const loadingB = addMessage('chatB', 'loading', 'Thinking...');

      document.getElementById('sendBtn').disabled = true;

      // Call both in parallel
      const [resultA, resultB] = await Promise.allSettled([
        callOpenAI(systemA, historyA, model),
        callOpenAI(systemB, historyB, model)
      ]);

      // Handle A
      loadingA.remove();
      if (resultA.status === 'fulfilled') {
        addMessage('chatA', 'assistant', resultA.value.content);
        historyA.push({ role: 'assistant', content: resultA.value.content });
        document.getElementById('tokensA').textContent = `${resultA.value.tokens} tokens`;
      } else {
        addMessage('chatA', 'error', resultA.reason.message);
      }

      // Handle B
      loadingB.remove();
      if (resultB.status === 'fulfilled') {
        addMessage('chatB', 'assistant', resultB.value.content);
        historyB.push({ role: 'assistant', content: resultB.value.content });
        document.getElementById('tokensB').textContent = `${resultB.value.tokens} tokens`;
      } else {
        addMessage('chatB', 'error', resultB.reason.message);
      }

      document.getElementById('sendBtn').disabled = false;
    }

    function clearChats() {
      document.getElementById('chatA').innerHTML = '';
      document.getElementById('chatB').innerHTML = '';
      document.getElementById('tokensA').textContent = '';
      document.getElementById('tokensB').textContent = '';
      historyA.length = 0;
      historyB.length = 0;
    }

    function retryLast() {
      if (!lastUserMessage) return;
      // Remove last exchange
      if (historyA.length >= 2) {
        historyA.pop(); historyA.pop();
        const chatA = document.getElementById('chatA');
        chatA.lastChild?.remove(); chatA.lastChild?.remove();
      }
      if (historyB.length >= 2) {
        historyB.pop(); historyB.pop();
        const chatB = document.getElementById('chatB');
        chatB.lastChild?.remove(); chatB.lastChild?.remove();
      }
      document.getElementById('userInput').value = lastUserMessage;
      sendMessage();
    }
  </script>
</body>
</html>
